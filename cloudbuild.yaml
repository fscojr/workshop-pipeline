steps:
- name: 'gcr.io/google.com/cloudsdktool/cloud-sdk'
  args: ['gsutil', 'cp', '-r', 'gs://teste-jrtrend/.ssh', '/builder/home/']
- name: 'gcr.io/google.com/cloudsdktool/cloud-sdk'
  entrypoint: /bin/bash
  args: ['-c', 'chmod 400 /builder/home/.ssh/id_rsa']
- name: 'gcr.io/cloud-builders/gcloud'
  entrypoint: "bash"
  args:
    - "-c"
    - |
      ls -ltr 
  volumes:
  - name: 'ssh'
    path: /builder/home/.ssh/

- name: 'gcr.io/cloud-builders/git'
  entrypoint: 'bash'
  args:
  - '-c'
  - |
    chmod 600 /root/.ssh/id_rsa
    cat <<EOF >/root/.ssh/config
    Hostname github.com
    IdentityFile /root/.ssh/id_rsa
    EOF
    ssh-keyscan -t rsa github.com > /root/.ssh/known_hosts
  volumes:
  - name: 'ssh'
    path: /builder/home/.ssh/

- name: 'gcr.io/cloud-builders/git'
  args:
  - clone
  - --recurse-submodules
  - git@github.com:fscojr/workshop-pipeline.git
  volumes:
  - name: 'ssh'
    path: /builder/home/.ssh/



#- name: 'gcr.io/cloud-builders/gcloud'
#  args: [ 'beta', 'compute', 'scp', '--recurse', '/workdir/*', '--zone=us-central1-a', 'build@pipeline:/tmp/teste', '--ssh-key-file=/builder/home/.ssh/id_rsa' ]
- name: 'gcr.io/cloud-builders/gcloud'
  args: [ 'beta', 'compute', 'ssh', '--zone=us-central1-a', 'build@pipeline', '--ssh-key-file=/builder/home/.ssh/id_rsa', '--', 'ls -ltr' ]
